{% macro to_yaml(item) -%}
{%- for key, value in item.items() %}
{%- if value is mapping %}
{{ key }}:
{%- filter indent(width=2) -%}
{{ to_yaml(value) }}
{%- endfilter %}
{%- else %}
{{ key }}: {{value}}
{%- endif %}
{%- endfor %}
{%- endmacro %}

global:
  argocd:
    destination:
      name: in-cluster
      server: ''
  {%- filter indent(width=2) -%}
  {{ to_yaml(global)}}
  {%- endfilter %}

applications:
  helm:
  {%- for key2, app in helm.items() %}
    - name: {{key2}}
      path: {{app.path}}
      chartRevision: {{app.chartRevision}}
      chart: {{app.chart}}
      values:
      {%- for valueFile in app.valueFiles %}
        {% filter indent(width=8) -%}
        {%- include "environment/"+global.namespace+'/'+app.path+'/'+valueFile -%}
        {%- endfilter %}
      {%- endfor %}
  {%- endfor %}
